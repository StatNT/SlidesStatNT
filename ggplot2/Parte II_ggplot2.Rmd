---
title: <span style="color:#88398A">Parte II, ggplot2</span>
author: <span style="color:#88398A"> <font size="6">Natalia da Silva, \@STA_NT</span></font>

date: <span style="color:#88398A"> 22 de Marzo, 2018
output: ioslides_presentation
logo: logoclass.png
widescreen: no
---

 <style>
 .title-slide {
     background-image: url(logo.png);
     background-repeat: no-repeat;
     padding:40px;
     background-position: 90% 80%;
     background-size: 200px 200px;
   }
   </style>
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## <span style="color:#88398A">Gramática de gráficos </span>

Clase pasada:

- **data**: con mapeos (aes) entre los datos y los elementos gráficos
- **layers**: elementos geométricos (**geoms**, son puntos, lineas, rectángulos, texto, ...) y transformaciones estadísticas (**stats**, son identidades, conteos, bins,...)
- **scales**: mapea valores en el espacio de los datos a valores en el espacio estético (ej. color, tamaño, forma o tb posición) 
- **coord**: normalmente Cartesianas, pero ej pie charts ej; polar
- **facetas**: como se arregla el display cuando son muchos gráficos 
- **theme** items para mejorar el dibujo como fuente, tamaño color, background...

## <span style="color:#88398A">Gramática de gráficos </span>

```{r, echo = TRUE, fig.height = 4, fig.width = 5,  warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

library(ggplot2)

ggplot(mpg, aes(displ, hwy, colour = factor(cyl))) +
  geom_point()   

```

## <span style="color:#88398A">Qué hay atraás de este plot?</span>

- Cada observación representada como un punto cuya posición está de acuerdo a dos variables (posición horizontal y vertical)

- Cada punto tiene tamaño,  color y forma estos atributos son llamados elementos estéticos (inglés aesthetics `aes` )

-  Los `aes` son propiedades que pueden ser percibidas en el gráfico
cada `aes` puede ser mapeado a una variable o fijado en un valor constante

- `displ` es mapeado a la posición horizontal, `hwy`  a la posición vertical y `cyl` al color. Tamaño y forma no son mapeados a variables (valor por defecto) 

## <span style="color:#88398A">Qué hay atrás de este plot?</span>

```{r, warning = FALSE, message = FALSE}
library(dplyr)
mpg %>% select(displ, hwy, cyl) %>% head(n=3)

```
- Nuevos datos, mapeo de los elementos estétocos a los datos origianles

|x  | y | colour|
|---|---|-------|
|1.8|	29|	     4|		
|1.8|	29|	     4|		
|2.0|	31|	     4|		


## <span style="color:#88398A">Otros geoms: geom_smooth</span>
 
 Cuando substituímos `geom_pont()` por otro `geom` obtenemos un plot distinto.
 Los `geom` más comunes:
 
- `geom_smooth()`  
- `geom_boxplot()`
- `geom_histogram()` 
- `geom_bar()`
- `geom_path()` y `geom_lines()`

## <span style="color:#88398A">Mismos datos dif plots</span>
```{r, echo=TRUE}
ggplot(mpg, aes(displ, hwy, colour = factor(cyl))) + geom_line() +
theme(legend.position = "none")
```



## <span style="color:#88398A">Mismos datos dif plots</span>
```{r, echo=TRUE}

ggplot(mpg, aes(displ, hwy, colour = factor(cyl))) + 
  geom_bar(stat = "identity", position = "identity", fill = NA) + theme(legend.position = "none")
```

## <span style="color:#88398A">Mismos datos dif plots</span>

- Con los mismos datos podemos generar muchos gráficos que aunque estaán gramaticalmente bien, son visualizaciones que no tienen sentido


## <span style="color:#88398A">Otros geoms: geom_smooth</span>
Si el scatterplot tiene mucho ruido se puede usar un suavizado para facilitar ver el patrón dominante usando `geom_smooth()`.

Algunos argumentos...

Distintos `methods` de suavizado por ejemplo `lm`, `glm`, `gam`, `loess` y `rlm`

`se` muestra el intervalo de confianza, por defecto es `TRUE`

`span` controla el monto de suavizado, valores altos produce lineas más suaves

## <span style="color:#88398A">Incluir un suavizado</span>
```{r, echo=FALSE}
library(ggplot2)
# cargamos los datos 
tips <- read.csv("http://www.ggobi.org/book/data/tips.csv")

```
```{r, echo = TRUE, fig.height = 4, fig.width = 5, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip)) +
  geom_point() + theme(aspect.ratio = 1) +
  geom_smooth()
```


## <span style="color:#88398A">Incluir un suavizado lineal</span>
```{r, echo = TRUE, fig.height = 4, fig.width = 5, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip)) +
  geom_point() +  theme(aspect.ratio = 1) +
  geom_smooth(method = "lm")
```


## <span style="color:#88398A">Incluir una recta </span>

```{r, echo = TRUE, fig.height = 3, fig.width = 3, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }
tips.lm <- lm(tip ~ totbill, data = tips)
coef <- tips.lm$coefficients
ggplot(data = tips, aes(x = totbill, y = tip)) +
  geom_point() + theme(aspect.ratio = 1) +
  geom_abline(intercept = coef[[1]] , slope = coef[[2]] )

```


## <span style="color:#88398A">scales </span>

- Los datos hay que convertirlos desde unidades datos (litros, millas, etc) a unidades gráficas (color, pixeles, etc) que se pueden reprensetar en la compu

- La conversión es llamada escalado y es realizada por `scales`

- `colour` son representados por una cadena de seis letras, `sizes` por nuúmeros y `shape` por enteros

- Estas especificaciones estéticas que tienen sentido para R se describen en ` vignette("ggplot2-specs")`

## <span style="color:#88398A">Incluir labs</span>

```{r, echo = TRUE, fig.height = 3, fig.width = 4,  warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip, colour = sex)) +
  geom_point() +  theme(aspect.ratio = 1) +
  labs(x = "Total de la cuenta", y = "Propina", 
                      colour = "Sexo")
   
 
```

## <span style="color:#88398A">Incluir labs </span>
```{r, echo = TRUE, fig.height = 3, fig.width = 4,  warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }
ggplot(data = tips, aes(x = totbill, y = tip, colour = sex)) +
  geom_point() + theme(aspect.ratio = 1) + 
  scale_x_continuous(name ="Total de la cuenta") +
  scale_y_continuous(name = "Propina") +
  scale_color_discrete("Sexo")
```

## <span style="color:#88398A"> theme</span> 

- `theme` en un plot permite contolar los elementos que no son datos en tu plot.

- Ayuda a hacer tu plot estéticamente como lo querés no afecta el mapeo de datos.

- `theme` te da control sobre las fuente, el fondo, ticks, etc.


## <span style="color:#88398A"> Más geoms</span>

http://ggplot2.tidyverse.org/reference/


## <span style="color:#88398A">ggplot2 ayuda</span>

Lista de mails: http://groups.google.com/group/ggplot2

stackoverflow: http://stackoverflow.com


<!-- ## <span style="color:#88398A">A trabajar junt\@s!</span> -->
<!-- Con los datos `diamonds` o una muestra de 1000 obs -->

<!-- `dsamp <- diamonds[sample(nrow(diamonds), 1000), ]` -->

<!-- - Scatter plot de   `price` (precio en dólares) vs `carat` (peso de los diamantes) -->
<!-- - Incluir usando `labs` el nombre de los ejes, título informativo y nombre de la leyenda -->
<!-- - Colorear usando la variable `cut` -->
<!-- - usar transparencias para el sobre ploteado `alpha` -->


<!-- ## <span style="color:#88398A">Solución I</span> -->

<!-- ```{r} -->

<!-- ggplot(data = diamonds, aes(x = carat, y = price, colour = cut)) +  -->
<!--   geom_point( alpha = 1/3) + labs(x = "Peso", y = "Precio en dólares", -->
<!--                                   title = "Scatterplot precio vs pesos", -->
<!--                                   colour="Corte")  -->
<!-- ``` -->

<!-- ## <span style="color:#88398A">A trabajar junt\@s!</span> -->

<!-- - Cambiar la paleta a `Set2` -->
<!-- - ? `scale_colour_brewer` -->
<!-- http://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3 -->

<!-- ##<span style="color:#88398A">Solución II</span> -->
<!-- ```{r} -->
<!-- ggplot(data = diamonds, aes(x = carat, y = price, colour = cut)) +  -->
<!--   geom_point( alpha = 1/3) + labs(x = "Peso", y = "Precio en dólares", -->
<!--                                   title = "Scatterplot precio vs peso", -->
<!--                                   colour = "Corte") + -->
<!--                                   scale_colour_brewer(palette = "Set2") -->
<!-- ``` -->


<!-- ##<span style="color:#88398A">A trabajar junt\@s!</span> -->
<!-- - **scale** controla el mapeo de los datos a los elementos estéticos -->

<!-- El argumento `breaks` controla los valores que aparecen en los "tick marks" en los ejes y tienen asociado una etiqueta que está controlada por `label`   -->

<!-- - Cambiar los tick marks en el eje x a 1, 3 y 5 con las etiquetas 1 oz, 3 oz y 5 oz. -->

<!-- - `?scale_x_continuous` -->


<!-- ##<span style="color:#88398A">Solución III</span> -->

<!-- ```{r} -->

<!-- ggplot(data = diamonds, aes(x = carat, y = price, colour = cut)) +  -->
<!--   geom_point( alpha = 1/3) + labs(x = "Peso", y = "Precio en dólares", -->
<!--                                   title = "Scatterplot precio vs pesos ", -->
<!--                                   colour = "Corte") + -->
<!--   scale_x_continuous(breaks = c(1, 3, 5), labels = c("1 oz", "3 oz", "5 oz")) -->


<!-- ``` -->


<!-- ##<span style="color:#88398A">A trabajar junt\@s!</span>  -->

<!-- Con los datos diamonds -->

<!-- - Scatterplot de   `price` (precio en dólares) vs `carat` (peso de los diamantes) -->
<!-- - Incluir usando `labs` el nombre de los ejes, título informativo y nombre de la leyenda -->
<!-- - Usar la variable `cut` para crear un gráfico para cada subconjunto - usar transparencias para el sobre ploteado `alpha` -->

<!-- ##<span style="color:#88398A">Solución IV</span>  -->
<!-- ```{r} -->

<!-- ggplot(data = diamonds, aes(x=carat, y = price)) +  -->
<!--   geom_point( alpha = 1/3) + facet_wrap(~cut)+ -->
<!--   labs(x = "Pesos", y = "Precio en dólares", -->
<!--                                   title = "Scatterplot precio vs peso", -->
<!--                                   colour = "Corte")  -->
<!-- ```  -->


