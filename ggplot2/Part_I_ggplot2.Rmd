---
title: <span style="color:#88398A">Parte I, ggplot2</span>
author: <span style="color:#88398A"> <font size="6">Natalia da Silva, \@STA_NT</span></font>

date: <span style="color:#88398A"> 19 de Marzo, 2018
output: ioslides_presentation
logo: logoclass.png
widescreen: no
---

 <style>
 .title-slide {
     background-image: url(logo.png);
     background-repeat: no-repeat;
     padding:40px;
     background-position: 90% 80%;
     background-size: 200px 200px;
   }
   </style>
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## <span style="color:#88398A"> De qué vamos a hablar hoy?</span> 

- ¿Porqué usar ggplot2 

- Gramática de gráficos

- Trabajo en grupo!


## <span style="color:#88398A">Importancia de la visulización</span> 

"The greatest value of a picture is when it forces us to notice what we never expected to see."

J. W. Tukey (1977)

## <span style="color:#88398A"> ¿Porqué usar ggplot2 ?</span>

**ggplot2** es un paquete para producir gráficos estadísticos o de datos desarrollado por  Hadley Wickham que a diferencia tiene una teoría que lo sustenta basada en Grammar of Graphics (Wilkinson, (1999))

 Es el paquete de gráficos estadísticos más dominante en R

El libro "ggplot2: Elegant Graphics for Data Analysis" está disponible:

 https://github.com/hadley/ggplot2-book
 
 
## <span style="color:#88398A"> Grammar of Graphics </span>

El **Grammar of Graphics** nos responde la pregunta:
 ¿Que es un gráfico estadístico?

Gráfico estadístico es un mapeo de los datos a atributos estéticos de objetos geométricos

## <span style="color:#88398A">¿Porqué GG ? </span>

 Aprender en base a una grámatica gráfica te permite graficar cosas que sabés pero además crear nuevas y tal vez mejores gráficos para visualizar tus datos.

El límite es tu imaginación!!!!

## <span style="color:#88398A">ggplot2 </span>


- Conjunto de componentes independientes, le da flexibilidad

- No limitado a gráficos pre determinados, crear lo que quieras

- Definido en base a un conjunto de principios, fácil de aprender

- Puedés producir gráficos estandard de calidad publicable en poco tiempo

- Diseñado para trabajar iterativamente agregando capas


## <span style="color:#88398A">Gramática de gráficos </span>

- **data**: con mapeos (aes) entre los datos y los elementos gráficos
- **layers**: elementos geométricos (**geoms**, son puntos, lineas, rectángulos, texto, ...) y transformaciones estadísticas (**stats**, son identidades, conteos, bins,...)
- **scales**: mapea valores en el espacio de los datos a valores en el espacio estético (ej. color, tamaño, forma o tb posición) 
- **coord**: normalmente Cartesianas, pero ej pie charts ej; polar
- **facetas**: como se arregla el display cuando son muchos gráficos 
- **theme** items para mejorar el dibujo como fuente, tamaño color, background...


## <span style="color:#88398A">Instalar ggplot2</span>

- Instalar ggplot2

```r
install.packages("ggplot2") 
```
```{r}
library(ggplot2) 
```

o si quieren cargar la versión más actualizada o en desarrollo
https://github.com/tidyverse/ggplot2

```r
install.packages("devtools")
library(devtools)
install_github("tidyverse/ggplot2")
```

## <span style="color:#88398A"> Ejemplo propina </span>

```{r, echo=TRUE, chache}
# cargamos los datos 
tips <- read.csv("http://www.ggobi.org/book/data/tips.csv")
head(tips)
```


## <span style="color:#88398A"> Tres componentes de todo plot </span>

- **data**: datos. 
- **aes**: un conjunto de mapeos estéticos entre las variables en los datos y las propiedades visuales. 
- **layer**: al menos una capa que describe como representar cada observación. Las capas son creadas con la función **geom**.

## <span style="color:#88398A">Tres componentes de todo plot</span>
- **data**: tips.
- **aes**: totbill mapeado a la posición x , tip a la posición y.
-  **layer**: puntos mediante geom_point.
```{r, echo = TRUE, fig.height = 3, fig.width = 3, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }
ggplot(data = tips, aes(x = totbill, y = tip)) +  
  geom_point() +
  theme(aspect.ratio = 1)

```

## <span style="color:#88398A">Ejemplo tips</span>
 
 ¿Qué vemos?

 - Hay una relación lineal débil entre propina y la cuenta total

 - Hay mucha variabilidad

- Las lineas horizontales indican la preferencia de la gente a dar de a 1 dólar de propina c/u


## <span style="color:#88398A">Color, tamaño, forma y otros aes</span>

Para agregar otras variables al plot podemos usar otros **aes** como color, forma o tamaño

```r
aes(x = totbill, y = tip, colour = sex)

aes(x = totbill, y = tip, shape = sex)

aes(x = totbill, y = tip, size = size)
```

## <span style="color:#88398A">Color </span>

```{r, echo = TRUE, fig.height = 4, fig.width = 5, cache = TRUE, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip, colour = sex)) +
  geom_point() + theme(aspect.ratio = 1)
   
 
```

## <span style="color:#88398A">Color fijo </span>
Si queremos fijar un estético a un valor fijo hay que hacerlo en la capa de afuera sin aes.

```{r, echo = TRUE, fig.height = 3, fig.width = 3, cache = TRUE, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip) )+
  geom_point(colour = "blue") + theme(aspect.ratio = 1)
   
 
```

## <span style="color:#88398A">Forma </span>

```{r, echo = TRUE, fig.height = 4, fig.width = 5, cache = TRUE, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip, shape = sex)) +
  geom_point() + theme(aspect.ratio = 1)
   
 
```

## <span style="color:#88398A">Tamaño</span>

```{r, echo = TRUE, fig.height = 4, fig.width = 5, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip, size = size)) +
  geom_point(alpha = 1 / 3) + theme(aspect.ratio = 1)
   
 
```

## <span style="color:#88398A">Tamaño</span>

```{r, echo = TRUE, fig.height = 4, fig.width = 4, cache = TRUE, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }

ggplot(data = tips, aes(x = totbill, y = tip) ) +
  geom_point(size = 5, alpha = 1 / 3) + theme(aspect.ratio = 1)
   
 
```



## <span style="color:#88398A">Faceteado</span>

- Se pueden desplegar variables categóricas adicionales en un plot  usando faceteado.

- Crea tablas de gráficos partiendo los datos en subconjuntos y mostrandolos el mismo plot para cada subconjunto.

- Dos tipos:  `facet_grid` and `facet_wrap`


## <span style="color:#88398A">Faceteado con facet_wrap </span>

```{r, echo = TRUE, fig.height = 4, fig.width = 7, cache = TRUE, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }
ggplot(data = tips, aes(x = totbill, y = tip)) +
  geom_point() +  theme(aspect.ratio = 1) +
 facet_wrap( ~sex)
 
```

## <span style="color:#88398A">Faceteado con facet_grid </span>

```{r, echo = TRUE, fig.height = 4, fig.width = 5, warning = FALSE, message=FALSE,fig.align="center", strip.white=TRUE }
ggplot(data = tips, aes(x = totbill, y = tip)) +
  geom_point() + theme(aspect.ratio = 1) +
 facet_grid(sex~ smoker)
 
```

